<renderpath>

    <rendertarget name="halfDepth" sizedivisor="2 2" format="r32f" />
    <rendertarget name="ao" sizedivisor="2 2" format="l" />
    <rendertarget name="blur" sizedivisor="1 1" format="l" />

    <command type="quad" tag="SSAO" vs="SSAO" ps="SSAO" psdefines="DOWNRES_DEPTH" output="halfDepth">
        <texture unit="1" name="depth" />
    </command>

    <command type="quad" tag="SSAO" vs="SSAO" ps="SSAO" psdefines="GEN_AO" output="ao">
        <texture unit="0" name="Textures/Random.png" />
        <texture unit="1" name="halfDepth" />
        <texture unit="2" name="normal" />

        <parameter name="Radius" value="0.35" />
        <parameter name="Bias" value="0" />
        <parameter name="Strength" value="1" />

        <parameter name="NoiseScale" value="4 4" />
    </command>

    <!--command type="quad" tag="SSAO" vs="CopyFramebuffer" ps="CopyFramebuffer">
        <texture unit="0" name="ao" />
    </command-->

    <!-- Bilateral blur kind of looks gross, lots of flickering. Even worse when trying to use it to upscale the AO buffer -->
    
    <command type="quad" tag="SSAO" vs="SSAO" ps="SSAO" psdefines="GEN_BLUR" output="blur">
        <parameter name="BlurDir" value="1 0" />

        <texture unit="0" name="ao" />
        <texture unit="1" name="halfDepth" />
        <texture unit="2" name="depth" />
    </command>

    <command type="quad" tag="SSAO" vs="SSAO" ps="SSAO" psdefines="GEN_BLUR" blend="multiply">
        <parameter name="BlurDir" value="0 1" />

        <texture unit="0" name="blur" />
        <texture unit="1" name="halfDepth" />
        <texture unit="2" name="depth" />
    </command>

    <!--command type="quad" tag="SSAO" vs="SSAO" ps="SSAO" psdefines="UPSAMPLE" blend="replace">
        <texture unit="0" name="ao" />
        <texture unit="1" name="halfDepth" />
        <texture unit="2" name="depth" />
    </command-->
</renderpath>